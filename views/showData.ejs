<%- include('templates/header')%>

<article id="contenido" class="">

    <br><br><br>
    
    <div class="row">
        <div class="col-4"></div>
        <div class="col-4" id="ct">  <h1 id="Title" class="text-center text-light bg-muted">Registro actual de los sensores</h1></div>
        <div class="col-4"></div>
    </div>
    
    <br> 



        <div class="row">
        <div class="col-1"></div>
        <div class="col-10">
           
            <div class="row">
                <div class="col">
                    <div class="container mt-3 bg-dark text-light" id="tc">
                        <div >
                            <div class="card-header">
                              <br>
                            </div>
                            <h1>Cultivo</h1>
                            <div class="card-body ">
                                <table class="table table-bordered table-dark table-hover table-fixed" id="table_humedad">
                                        <th>Fecha</th>
                                        <th>Humedad</th>
                                        <th>Sensor</th>
                                    </thead>
                                    <tbody id="humedad_body">
                    
                
                    
                                    </tbody>
                                </table>
                                <br>
                            </div>
                            <div class="card-footer"></div>
                        </div>   
                    </div>
                </div>
                <div class="col-1"></div>
                <div class="col">
                 
                    <div class="container mt-3 bg-dark text-light" id="tc"> 
                        <div >
                            <div class="card-header">
                              <br>
                            </div>
                            <h1>Corral</h1>
                            <div class="card-body ">
                                <table class="table table-bordered table-dark table-hover" id="table_move">
                                        <th>Fecha</th>
                                        <th>Movimiento</th>
                                        <th>Sensor</th>
                                    </thead>
                                    <tbody id="move_body">
                    
                
                    
                                    </tbody>
                                </table>
                                <br>
                            </div>
                            <div class="card-footer"></div>
                        </div>   
                    </div>



                </div>
              </div>





        </div>
        <div class="col-1"></div>
      </div>


    
    
      <script>
                    
        log = [];
        oJson = {};
        var htmlTags = "";
        var maxRows = 5; // Establece el número máximo de filas

        var humedadCount = 0; // Contador para la tabla de humedad
        var moveCount = 0; // Contador para la tabla de movimiento

        function rJson() {

            fetch('http://localhost:3000/api/getData')
                .then((response) => response.json())
                .then((json) => {

                    oJson = json;
                    console.log(oJson);

                    $('#humedad_body').empty(); // Limpia la tabla antes de agregar las nuevas filas
                    humedadCount = 0; // Reinicia el contador

                    oJson[0].datos.map((data) => {
                        console.log(data);
                        if (humedadCount < maxRows) { // Comprueba si el contador es menor que el número máximo de filas
                            htmlTags += '<tr id="HTab">' +
                                '<td>' + data.fecha + '</td>' +
                                '<td>' + data.valor + '</td>' +
                                '<td>' + data.sensor + '</td>'+
                                '</tr>';
                            humedadCount++; // Aumenta el contador
                        }
                    });
                    $('#humedad_body').append(htmlTags);
                    htmlTags = ""; // Limpia el valor de htmlTags para la siguiente tabla

                    $('#move_body').empty(); // Limpia la tabla antes de agregar las nuevas filas
                    moveCount = 0; // Reinicia el contador

                    oJson[1].datos.map((datas) => {
                        console.log(datas);
                        if (moveCount < maxRows) { // Comprueba si el contador es menor que el número máximo de filas
                            htmlTags += '<tr id="MTab">' +
                                '<td>' + datas.fecha + '</td>' +
                                '<td>' + datas.valor + '</td>' +
                                '<td>' + datas.sensor + '</td>' +
                                '</tr>';
                            moveCount++; // Aumenta el contador
                        }
                    });
                    $('#move_body').append(htmlTags);
                    htmlTags = ""; // Limpia el valor de htmlTags para la siguiente tabla

                })
            return true;
        }
        setInterval(rJson, 5000); // Llama a la función rJson cada 5 segundos

    </script>
    
    
    
    <br><br><br>
    
    
    </article>
<%- include('templates/footer')%>